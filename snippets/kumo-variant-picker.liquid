{% comment %}
  KUMO Variant Picker
  Usage: {% render 'kumo-variant-picker', product: product %}
{% endcomment %}

{%- unless product.has_only_default_variant -%}
  <div class="kumo-variant-picker" data-variant-picker>
    {%- for option in product.options_with_values -%}
      <div class="kumo-variant-picker__option" data-option-index="{{ forloop.index0 }}">
        <label class="kumo-variant-picker__label">
          {{ option.name }}
        </label>

        {%- liquid
          assign is_color = false
          assign option_name_lower = option.name | downcase
          if option_name_lower contains 'color' or option_name_lower contains 'couleur' or option_name_lower contains 'colour'
            assign is_color = true
          endif
        -%}

        <div class="kumo-variants">
          {%- for value in option.values -%}
            {%- liquid
              assign variant_available = true
              assign option_index = 'option' | append: forloop.parentloop.index
              for variant in product.variants
                assign variant_option = variant[option_index]
                if variant_option == value
                  unless variant.available
                    assign variant_available = false
                  endunless
                  break
                endif
              endfor
            -%}

            {%- if is_color -%}
              <button
                type="button"
                class="kumo-variant-color {% if option.selected_value == value %}is-selected{% endif %} {% unless variant_available %}is-unavailable{% endunless %}"
                data-option-value="{{ value }}"
                style="background-color: {{ value | handleize }};"
                title="{{ value }}"
                aria-label="{{ value }}"
                {% unless variant_available %}disabled{% endunless %}
              >
                <span class="visually-hidden">{{ value }}</span>
              </button>
            {%- else -%}
              <button
                type="button"
                class="kumo-variant-size {% if option.selected_value == value %}is-selected{% endif %} {% unless variant_available %}is-unavailable{% endunless %}"
                data-option-value="{{ value }}"
                {% unless variant_available %}disabled{% endunless %}
              >
                {{ value }}
              </button>
            {%- endif -%}
          {%- endfor -%}
        </div>
      </div>
    {%- endfor -%}
  </div>
{%- endunless -%}

<style>
  .kumo-variant-picker {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .kumo-variant-picker__label {
    display: block;
    font-family: var(--kumo-font-family);
    font-weight: 600;
    font-size: 0.875rem;
    color: var(--kumo-foreground);
    margin-bottom: 0.75rem;
  }

  .visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
</style>
