{{ 'kumo-customer.css' | asset_url | stylesheet_tag }}

{%- if section.settings.enable_shop_login_button == false -%}
  {%- assign hide_shop_login_button = true -%}
{%- endif -%}

{%- form 'recover_customer_password' -%}
  {%- assign recover_success = form.posted_successfully? -%}
{%- endform -%}

<div class="kumo-customer">
  <!-- ===== FORMULAIRE RÉCUPÉRATION MOT DE PASSE ===== -->
  <div id="recover" class="kumo-recover-form">
    <div class="kumo-customer-card">
      <div class="kumo-customer-header">
        <div class="kumo-customer-icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />
          </svg>
        </div>
        <h1 tabindex="-1">{{ 'customer.recover_password.title' | t }}</h1>
        <p class="kumo-customer-subtitle">{{ 'customer.recover_password.subtext' | t }}</p>
      </div>

      {%- form 'recover_customer_password' -%}
        {%- if form.errors -%}
          <div class="kumo-error">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
            {{ form.errors.messages.form }}
          </div>
        {%- endif -%}

        <div class="kumo-field">
          <label for="RecoverEmail">{{ 'customer.login_page.email' | t }}</label>
          <input
            type="email"
            value=""
            name="email"
            id="RecoverEmail"
            autocorrect="off"
            autocapitalize="off"
            autocomplete="email"
            {% if form.errors %}
              aria-invalid="true"
              aria-describedby="RecoverEmail-email-error"
              autofocus
            {% endif %}
            placeholder="{{ 'customer.login_page.email' | t }}"
          >
        </div>

        <button type="submit" class="kumo-btn-primary">
          {{ 'customer.login_page.submit' | t }}
        </button>
      {%- endform -%}

      <div class="kumo-customer-footer">
        <a href="#login" class="kumo-link" onclick="toggleRecoverForm(false)">
          ← {{ 'customer.login_page.cancel' | t }}
        </a>
      </div>
    </div>
  </div>

  <!-- ===== FORMULAIRE CONNEXION ===== -->
  <div id="login" class="kumo-login-form">
    <div class="kumo-customer-card">
      <div class="kumo-customer-header">
        <div class="kumo-customer-icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
        </div>
        <h1 tabindex="-1">{{ 'customer.login_page.title' | t }}</h1>
        <p class="kumo-customer-subtitle">Ravi de vous revoir !</p>
      </div>

      {%- if recover_success == true -%}
        <div class="kumo-success">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          {{ 'customer.recover_password.success' | t }}
        </div>
      {%- endif -%}

      {%- form 'customer_login', novalidate: 'novalidate' -%}
        {%- if form.errors -%}
          <div class="kumo-error" tabindex="-1" autofocus>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
            <span class="visually-hidden">{{ 'accessibility.error' | t }}</span>
            {{ 'templates.contact.form.error_heading' | t }}
          </div>
        {%- endif -%}

        <div class="kumo-field">
          <label for="CustomerEmail">{{ 'customer.login_page.email' | t }}</label>
          <input
            type="email"
            name="customer[email]"
            id="CustomerEmail"
            autocomplete="email"
            autocorrect="off"
            autocapitalize="off"
            {% if form.errors contains 'form' %}
              aria-invalid="true"
            {% endif %}
            placeholder="{{ 'customer.login_page.email' | t }}"
          >
        </div>

        {%- if form.password_needed -%}
          <div class="kumo-field">
            <label for="CustomerPassword">{{ 'customer.login_page.password' | t }}</label>
            <input
              type="password"
              value=""
              name="customer[password]"
              id="CustomerPassword"
              autocomplete="current-password"
              {% if form.errors contains 'form' %}
                aria-invalid="true"
              {% endif %}
              placeholder="{{ 'customer.login_page.password' | t }}"
            >
          </div>

          <a href="#recover" class="kumo-link kumo-forgot-link" onclick="toggleRecoverForm(true)">
            {{ 'customer.login_page.forgot_password' | t }}
          </a>
        {%- endif -%}

        <button type="submit" class="kumo-btn-primary">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
          </svg>
          {{ 'customer.login_page.sign_in' | t }}
        </button>
      {%- endform -%}

      {%- if shop.features.login_with_shop_classic_customer_accounts? -%}
        {%- unless hide_shop_login_button -%}
          <div class="kumo-divider">
            <span>{{ 'customer.login_page.alternate_provider_separator' | t }}</span>
          </div>
          <div class="kumo-social-login">
            {{ shop | login_button: hide_button: hide_shop_login_button }}
          </div>
        {%- endunless -%}
      {%- endif -%}

      <div class="kumo-customer-footer">
        Pas encore de compte ?
        <a href="{{ routes.account_register_url }}">{{ 'customer.login_page.create_account' | t }}</a>
      </div>
    </div>
  </div>

  {%- if shop.checkout.guest_login -%}
    <div class="kumo-customer-card" style="margin-top: 1.5rem;">
      <h2 style="font-size: 1.1rem; text-align: center; margin: 0 0 1rem;">{{ 'customer.login_page.guest_title' | t }}</h2>
      {%- form 'guest_login' -%}
        <button type="submit" class="kumo-btn-secondary">
          {{ 'customer.login_page.guest_continue' | t }}
        </button>
      {%- endform -%}
    </div>
  {%- endif -%}
</div>

<script>
  function toggleRecoverForm(showRecover) {
    const recoverForm = document.querySelector('.kumo-recover-form');
    const loginForm = document.querySelector('.kumo-login-form');
    
    if (showRecover) {
      recoverForm.classList.add('active');
      loginForm.classList.add('hidden');
    } else {
      recoverForm.classList.remove('active');
      loginForm.classList.remove('hidden');
    }
  }

  // Check URL hash on load
  if (window.location.hash === '#recover') {
    toggleRecoverForm(true);
  }
</script>

{% schema %}
{
  "name": "t:sections.main-login.name",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_shop_login_button",
      "label": "t:sections.main-login.shop_login_button.enable",
      "default": true
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ]
}
{% endschema %}
