{% comment %}
  KUMO Gift Card - Zen Minimalist Design
  "La Simplicit√© Purifi√©e" - Zero friction experience
{% endcomment %}

<section class="kumo-gift-card">
  <div class="kumo-gift-card__container">

    {%- comment -%} Product Image - Always show first image, ignore variant images {%- endcomment -%}
    <div class="kumo-gift-card__image-wrapper">
      {%- assign gift_card_image = product.images[0] | default: product.featured_image -%}
      {%- if gift_card_image != blank -%}
        <img
          src="{{ gift_card_image | image_url: width: 800 }}"
          alt="{{ gift_card_image.alt | default: product.title | escape }}"
          class="kumo-gift-card__image"
          id="kumo-gift-card-image"
          loading="eager"
        >
      {%- else -%}
        <div class="kumo-gift-card__image-placeholder">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M20 12v10H4V12M2 7h20v5H2zM12 22V7M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7zM12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/>
          </svg>
        </div>
      {%- endif -%}
    </div>

    {%- comment -%} Badge {%- endcomment -%}
    <div class="kumo-gift-card__badge">
      <span class="kumo-gift-card__badge-icon">üéÅ</span>
      <span>{{ section.settings.badge_text | default: "Carte Cadeau Digitale" }}</span>
    </div>

    {%- comment -%} Title & Promise {%- endcomment -%}
    <div class="kumo-gift-card__header">
      <h1 class="kumo-gift-card__title">{{ section.settings.title | default: "Offrez un Nuage de Douceur." }}</h1>
      <p class="kumo-gift-card__subtitle">{{ section.settings.subtitle | default: "Le cadeau parfait, envoy√© <em>instantan√©ment</em> par email.<br>Valable sur toute la boutique." }}</p>
    </div>

    {%- comment -%} Amount Label {%- endcomment -%}
    <p class="kumo-gift-card__amount-label">Choisissez le montant :</p>

    {%- comment -%} Amount Selector - Square rounded buttons {%- endcomment -%}
    {%- assign default_variant = product.selected_or_first_available_variant -%}
    <div class="kumo-gift-card__amounts" id="kumo-gift-card-amounts">
      {%- for variant in product.variants -%}
        {%- assign variant_image = variant.featured_image | default: product.featured_image -%}
        <button
          type="button"
          class="kumo-gift-card__amount-btn{% if variant.id == default_variant.id %} kumo-gift-card__amount-btn--active{% endif %}"
          data-variant-id="{{ variant.id }}"
          data-price="{{ variant.price | money }}"
          data-image="{{ variant_image | image_url: width: 800 }}"
          onclick="selectGiftCardVariant(this)"
        >
          {{ variant.price | money_without_trailing_zeros }}
        </button>
      {%- endfor -%}
    </div>

    {%- comment -%} Add to Cart Form {%- endcomment -%}
    <form action="/cart/add" method="post" class="kumo-gift-card__form" id="kumo-gift-card-form">
      <input type="hidden" name="id" id="kumo-gift-card-variant" value="{{ default_variant.id }}">
      <input type="hidden" name="quantity" value="1">

      <button type="submit" class="kumo-gift-card__cta" id="kumo-gift-card-cta">
        <span>{{ section.settings.button_text | default: "Envoyer ce Cocon" }}</span>
        <span class="kumo-gift-card__cta-price" id="kumo-gift-card-price">({{ default_variant.price | money }})</span>
      </button>
    </form>

    {%- comment -%} Digital Reassurance - Minimal {%- endcomment -%}
    <div class="kumo-gift-card__reassurance">
      <div class="kumo-gift-card__reassurance-item">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect width="20" height="16" x="2" y="4" rx="2"/>
          <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
        </svg>
        <span>Re√ßu imm√©diatement</span>
      </div>
      <span class="kumo-gift-card__reassurance-dot">¬∑</span>
      <div class="kumo-gift-card__reassurance-item">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 12c-2-2.67-4-4-6-4a4 4 0 1 0 0 8c2 0 4-1.33 6-4Zm0 0c2 2.67 4 4 6 4a4 4 0 0 0 0-8c-2 0-4 1.33-6 4Z"/>
        </svg>
        <span>Valable sans limite</span>
      </div>
    </div>

    {%- comment -%} Product Description (supports HTML & video) {%- endcomment -%}
    {%- if product.description != blank and section.settings.show_description -%}
      <div class="kumo-gift-card__description">
        {{ product.description }}
      </div>
    {%- endif -%}

  </div>
</section>

<style>
  .kumo-gift-card {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem 1.5rem 4rem;
    background: var(--kumo-background, hsl(35, 45%, 97%));
  }

  .kumo-gift-card__container {
    max-width: 560px;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }

  /* Image - Large, super rounded, square ratio to show full design */
  .kumo-gift-card__image-wrapper {
    width: 100%;
    max-width: 420px;
    aspect-ratio: 1 / 1;
    margin-bottom: 1.5rem;
    border-radius: 1.5rem;
    overflow: hidden;
    box-shadow: 0 20px 50px -15px hsla(25, 30%, 30%, 0.2);
  }

  .kumo-gift-card__image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    background: linear-gradient(135deg, hsl(280, 40%, 92%) 0%, hsl(200, 50%, 92%) 100%);
    transition: opacity 0.15s ease;
  }

  .kumo-gift-card__image-placeholder {
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, hsl(30, 50%, 92%) 0%, hsl(35, 45%, 88%) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--kumo-muted-foreground, hsl(25, 20%, 50%));
  }

  /* Badge */
  .kumo-gift-card__badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 1.25rem;
    background: hsl(30, 30%, 85%);
    border-radius: 9999px;
    font-family: var(--kumo-font-family, 'Quicksand', sans-serif);
    font-size: 0.875rem;
    font-weight: 600;
    color: hsl(25, 35%, 35%);
    margin-bottom: 1.5rem;
  }

  .kumo-gift-card__badge-icon {
    font-size: 1rem;
  }

  /* Header */
  .kumo-gift-card__header {
    margin-bottom: 2rem;
  }

  .kumo-gift-card__title {
    font-family: var(--kumo-font-family, 'Quicksand', sans-serif);
    font-size: clamp(1.875rem, 5vw, 2.5rem);
    font-weight: 700;
    color: hsl(25, 30%, 35%);
    line-height: 1.2;
    margin: 0 0 1rem;
    letter-spacing: -0.01em;
  }

  .kumo-gift-card__subtitle {
    font-family: var(--kumo-font-family, 'Quicksand', sans-serif);
    font-size: 1rem;
    color: hsl(25, 15%, 55%);
    line-height: 1.7;
    margin: 0;
  }

  .kumo-gift-card__subtitle em {
    font-style: italic;
  }

  /* Amount Label */
  .kumo-gift-card__amount-label {
    font-family: var(--kumo-font-family, 'Quicksand', sans-serif);
    font-size: 0.8125rem;
    color: hsl(25, 15%, 60%);
    margin: 0 0 1rem;
  }

  /* Amount Selector - Square rounded buttons */
  .kumo-gift-card__amounts {
    display: flex;
    justify-content: center;
    gap: 0.625rem;
    margin-bottom: 1.5rem;
  }

  .kumo-gift-card__amount-btn {
    width: 72px;
    height: 72px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    border-radius: 1rem;
    background: hsl(35, 30%, 92%);
    color: hsl(25, 20%, 55%);
    font-family: var(--kumo-font-family, 'Quicksand', sans-serif);
    font-size: 1.25rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .kumo-gift-card__amount-btn:hover {
    background: hsl(30, 28%, 88%);
    color: hsl(25, 25%, 40%);
  }

  .kumo-gift-card__amount-btn--active {
    background: hsl(25, 30%, 52%);
    color: white;
  }

  .kumo-gift-card__amount-btn--active:hover {
    background: hsl(25, 30%, 48%);
    color: white;
  }

  /* CTA Button */
  .kumo-gift-card__form {
    width: 100%;
    max-width: 380px;
    margin-bottom: 1.5rem;
  }

  .kumo-gift-card__cta {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.375rem;
    padding: 1.125rem 2rem;
    background: hsl(25, 30%, 52%);
    color: white;
    border: none;
    border-radius: 9999px;
    font-family: var(--kumo-font-family, 'Quicksand', sans-serif);
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .kumo-gift-card__cta:hover {
    background: hsl(25, 30%, 46%);
  }

  .kumo-gift-card__cta-price {
    font-weight: 600;
  }

  /* Reassurance */
  .kumo-gift-card__reassurance {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.625rem;
    color: hsl(25, 15%, 60%);
    font-family: var(--kumo-font-family, 'Quicksand', sans-serif);
    font-size: 0.8125rem;
  }

  .kumo-gift-card__reassurance-item {
    display: flex;
    align-items: center;
    gap: 0.375rem;
  }

  .kumo-gift-card__reassurance-item svg {
    flex-shrink: 0;
    opacity: 0.7;
  }

  .kumo-gift-card__reassurance-dot {
    font-size: 1rem;
    opacity: 0.5;
  }

  /* Description with video support */
  .kumo-gift-card__description {
    width: 100%;
    max-width: 560px;
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid hsl(25, 20%, 90%);
    font-family: var(--kumo-font-family, 'Quicksand', sans-serif);
    font-size: 0.9375rem;
    line-height: 1.7;
    color: hsl(25, 15%, 50%);
    text-align: left;
  }

  .kumo-gift-card__description p {
    margin: 0 0 1rem;
  }

  .kumo-gift-card__description p:last-child {
    margin-bottom: 0;
  }

  .kumo-gift-card__description h1,
  .kumo-gift-card__description h2,
  .kumo-gift-card__description h3,
  .kumo-gift-card__description h4 {
    font-weight: 700;
    color: hsl(25, 30%, 35%);
    margin: 1.5rem 0 0.75rem;
  }

  .kumo-gift-card__description h1:first-child,
  .kumo-gift-card__description h2:first-child,
  .kumo-gift-card__description h3:first-child {
    margin-top: 0;
  }

  .kumo-gift-card__description ul,
  .kumo-gift-card__description ol {
    margin: 0 0 1rem;
    padding-left: 1.25rem;
  }

  .kumo-gift-card__description li {
    margin-bottom: 0.5rem;
  }

  /* Video container - responsive */
  .kumo-gift-card__description iframe,
  .kumo-gift-card__description video {
    width: 100%;
    max-width: 100%;
    height: auto;
    aspect-ratio: 16 / 9;
    border-radius: 1rem;
    margin: 1.5rem 0;
    box-shadow: 0 8px 30px -8px hsla(25, 30%, 20%, 0.15);
  }

  .kumo-gift-card__description img {
    max-width: 100%;
    height: auto;
    border-radius: 0.75rem;
    margin: 1rem 0;
  }

  /* Responsive */
  @media (max-width: 540px) {
    .kumo-gift-card {
      padding: 1.5rem 1rem 3rem;
    }

    .kumo-gift-card__image-wrapper {
      border-radius: 1.25rem;
    }

    .kumo-gift-card__amount-btn {
      width: 64px;
      height: 64px;
      font-size: 1.125rem;
      border-radius: 0.875rem;
    }

    .kumo-gift-card__reassurance {
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .kumo-gift-card__description {
      padding-top: 1.5rem;
      margin-top: 1.5rem;
    }

    .kumo-gift-card__description iframe,
    .kumo-gift-card__description video {
      border-radius: 0.75rem;
      margin: 1rem 0;
    }
  }
</style>

<script>
  function selectGiftCardVariant(btn) {
    // Remove active from all buttons
    var allBtns = document.querySelectorAll('.kumo-gift-card__amount-btn');
    for (var i = 0; i < allBtns.length; i++) {
      allBtns[i].classList.remove('kumo-gift-card__amount-btn--active');
    }

    // Add active to clicked button
    btn.classList.add('kumo-gift-card__amount-btn--active');

    // Update hidden variant input
    var variantInput = document.getElementById('kumo-gift-card-variant');
    if (variantInput) {
      variantInput.value = btn.getAttribute('data-variant-id');
    }

    // Update CTA price display
    var priceEl = document.getElementById('kumo-gift-card-price');
    if (priceEl) {
      priceEl.textContent = '(' + btn.getAttribute('data-price') + ')';
    }

    // Update product image
    var imageUrl = btn.getAttribute('data-image');
    var imageEl = document.getElementById('kumo-gift-card-image');
    if (imageEl && imageUrl) {
      imageEl.style.opacity = '0';
      setTimeout(function() {
        imageEl.src = imageUrl;
        imageEl.style.opacity = '1';
      }, 150);
    }
  }
</script>

{% schema %}
{
  "name": "KUMO - Carte Cadeau",
  "tag": "section",
  "class": "section-kumo-gift-card",
  "settings": [
    {
      "type": "text",
      "id": "badge_text",
      "label": "Texte du badge",
      "default": "Carte Cadeau Digitale"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Titre",
      "default": "Offrez un Nuage de Douceur."
    },
    {
      "type": "richtext",
      "id": "subtitle",
      "label": "Sous-titre",
      "default": "<p>Le cadeau parfait, envoy√© <em>instantan√©ment</em> par email.<br>Valable sur toute la boutique.</p>"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Texte du bouton",
      "default": "Envoyer ce Cocon"
    },
    {
      "type": "checkbox",
      "id": "show_description",
      "label": "Afficher la description du produit",
      "default": true,
      "info": "Affiche la description HTML du produit (supporte les vid√©os int√©gr√©es)"
    }
  ],
  "presets": [
    {
      "name": "KUMO - Carte Cadeau"
    }
  ]
}
{% endschema %}
