{{ 'kumo-customer.css' | asset_url | stylesheet_tag }}

{%- unless settings.cart_type == 'drawer' -%}
  <script src="{{ 'cart.js' | asset_url }}" defer="defer"></script>
{%- endunless -%}

<cart-items class="kumo-cart{% if cart == empty %} is-empty{% endif %}">
  <div class="kumo-cart-container">
    
    <!-- PANIER VIDE -->
    <div class="kumo-cart-empty">
      <div class="kumo-cart-empty__icon">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />
        </svg>
      </div>
      <h2>{{ 'sections.cart.empty' | t }}</h2>
      <p>Découvrez notre collection et laissez-vous tenter par nos créations</p>
      <a href="{{ routes.all_products_collection_url }}" class="kumo-btn-primary" style="display: inline-flex; width: auto; padding: 1rem 2rem;">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        {{ 'general.continue_shopping' | t }}
      </a>

      {%- if shop.customer_accounts_enabled and customer == null -%}
        <div class="kumo-cart-empty__login">
          <h3>{{ 'sections.cart.login.title' | t }}</h3>
          <p>{{ 'sections.cart.login.paragraph_html' | t: link: routes.account_login_url }}</p>
        </div>
      {%- endif -%}
    </div>

    <!-- PANIER AVEC PRODUITS -->
    <form action="{{ routes.cart_url }}" class="cart__contents critical-hidden" method="post" id="cart">
      
      <!-- Header -->
      <div class="kumo-cart-header">
        <h1>
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.5rem;">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />
          </svg>
          {{ 'sections.cart.title' | t }}
        </h1>
        <p class="kumo-cart-count">{{ cart.item_count }} {{ cart.item_count | pluralize: 'article', 'articles' }}</p>
        <a href="{{ routes.all_products_collection_url }}" class="kumo-cart-continue">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          {{ 'general.continue_shopping' | t }}
        </a>
      </div>

      <div class="kumo-cart-layout">
        <!-- Liste des produits -->
        <div class="kumo-cart-items" id="main-cart-items" data-id="{{ section.id }}">
          <div class="js-contents">
            {%- if cart != empty -%}
              {%- for item in cart.items -%}
                <div class="kumo-cart-item" id="CartItem-{{ item.index | plus: 1 }}">
                  <!-- Image -->
                  <div class="kumo-cart-item__media">
                    {% if item.image %}
                      <a href="{{ item.url }}" aria-hidden="true" tabindex="-1">
                        <img
                          src="{{ item.image | image_url: width: 300 }}"
                          class="kumo-cart-item__image"
                          alt="{{ item.image.alt | escape }}"
                          loading="lazy"
                          width="120"
                          height="120"
                        >
                      </a>
                    {% endif %}
                  </div>

                  <!-- Détails -->
                  <div class="kumo-cart-item__details">
                    <a href="{{ item.url }}" class="kumo-cart-item__title">{{ item.product.title | escape }}</a>
                    
                    {%- if item.product.has_only_default_variant == false or item.properties.size != 0 -%}
                      <div class="kumo-cart-item__variant">
                        {%- for option in item.options_with_values -%}
                          {{ option.name }}: {{ option.value }}{% unless forloop.last %} | {% endunless %}
                        {%- endfor -%}
                      </div>
                    {%- endif -%}

                    <!-- Prix -->
                    <div class="kumo-cart-item__price">
                      {%- if item.original_price != item.final_price -%}
                        <span class="kumo-cart-item__price-old">{{ item.original_price | money }}</span>
                      {%- endif -%}
                      {{ item.final_price | money }}
                    </div>

                    <!-- Discounts -->
                    {%- if item.line_level_discount_allocations.size > 0 -%}
                      <div class="kumo-cart-item__discounts">
                        {%- for discount in item.line_level_discount_allocations -%}
                          <span class="kumo-cart-item__discount">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                            </svg>
                            {{ discount.discount_application.title | escape }}
                          </span>
                        {%- endfor -%}
                      </div>
                    {%- endif -%}

                    <!-- Actions: Quantité + Supprimer -->
                    <div class="kumo-cart-item__actions">
                      <quantity-input class="kumo-quantity">
                        <button
                          class="kumo-quantity__btn"
                          name="minus"
                          type="button"
                          aria-label="{{ 'products.product.quantity.decrease' | t: product: item.product.title | escape }}"
                        >
                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M20 12H4" />
                          </svg>
                        </button>
                        <input
                          class="kumo-quantity__input"
                          type="number"
                          name="updates[]"
                          value="{{ item.quantity }}"
                          min="0"
                          aria-label="{{ 'products.product.quantity.input_label' | t: product: item.product.title | escape }}"
                          id="Quantity-{{ item.index | plus: 1 }}"
                          data-index="{{ item.index | plus: 1 }}"
                          data-quantity-variant-id="{{ item.variant.id }}"
                        >
                        <button
                          class="kumo-quantity__btn"
                          name="plus"
                          type="button"
                          aria-label="{{ 'products.product.quantity.increase' | t: product: item.product.title | escape }}"
                        >
                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                          </svg>
                        </button>
                      </quantity-input>

                      <cart-remove-button id="Remove-{{ item.index | plus: 1 }}" data-index="{{ item.index | plus: 1 }}">
                        <a
                          href="{{ item.url_to_remove }}"
                          class="kumo-cart-item__remove"
                          aria-label="{{ 'sections.cart.remove_title' | t: title: item.title | escape }}"
                        >
                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                          </svg>
                        </a>
                      </cart-remove-button>
                    </div>

                    <!-- Error message -->
                    <div class="cart-item__error" id="Line-item-error-{{ item.index | plus: 1 }}" role="alert">
                      <small class="cart-item__error-text"></small>
                    </div>
                  </div>
                </div>
              {%- endfor -%}
            {%- endif -%}
          </div>
        </div>

        <!-- Sidebar / Footer (géré par main-cart-footer) -->
      </div>

      <p class="visually-hidden" id="cart-live-region-text" aria-live="polite" role="status"></p>
      <p class="visually-hidden" id="shopping-cart-line-item-status" aria-live="polite" aria-hidden="true" role="status">
        {{ 'accessibility.loading' | t }}
      </p>
    </form>
  </div>
</cart-items>

{% schema %}
{
  "name": "t:sections.main-cart-items.name",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ]
}
{% endschema %}
